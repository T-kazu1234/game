(function(){enchant();window.onload=function(){var a,i,l,k,b,n,m,g,c,h,j,f,e,d;l=new Game(360,480);l.fps=24;l.preload("images/droid.png","images/beam.png","images/ship.png","images/laser.png","images/blast.png");l.rootScene.backgroundColor="black";c=0;h=new Label("SCORE : "+c);h.font="16px Tahoma";h.color="white";e=[10,5],h.x=e[0],h.y=e[1];l.rootScene.addChild(h);j=1;f=new Label("STAGE "+j);f.font="14px Tahoma";f.color="white";d=[280,450],f.x=d[0],f.y=d[1];f._style.zIndex=100;l.rootScene.addChild(f);l.end=false;a=[];i=[];n=40;m=4;g=100;k=function(){var p,o,t,r,q,s;a=[];for(t=r=0;r<5;t=++r){for(o=q=0;q<7;o=++q){p=new Sprite(32,32);p.image=l.assets["images/droid.png"];s=[o*(32+10),t*32+30],p.x=s[0],p.y=s[1];p._style.zIndex=2;p.tick=0;a.push(p);l.rootScene.addChild(p)}}return null};b=function(){var r,o,p,q,s;r=[];for(o=q=0;0<=n?q<n:q>n;o=0<=n?++q:--q){p=new Sprite(4,16);p.image=l.assets["images/laser.png"];s=[0,-999],p.x=s[0],p.y=s[1];p._style.zIndex=1;i.push(p);l.rootScene.addChild(p)}return null};l.onload=function(){var w,u,q,o,v,s,t,r,p;v=new Sprite(32,16);v.image=l.assets["images/ship.png"];t=[l.width/2,l.height-20],v.x=t[0],v.y=t[1];v._style.zIndex=1;l.rootScene.addChild(v);s=new Sprite(24,10);s._style.zIndex=1;l.rootScene.addChild(s);w=new Sprite(4,16);r=[v.x+14,v.y-8],w.x=r[0],w.y=r[1];w.image=l.assets["images/beam.png"];w._style.zIndex=2;l.rootScene.addChild(w);u=new Sprite(32,32);u.image=l.assets["images/blast.png"];u.y=-999;u._style.zIndex=10;l.rootScene.addChild(u);l.keybind(32,"a");p=[3,0],q=p[0],o=p[1];k();b();return l.rootScene.addEventListener(Event.ENTER_FRAME,function(){var D,C,x,z,A,F,G,y,H,E,B;B=function(){var I,L,K,J;L=Math.floor(Math.random()*g);if(L>=a.length){return}for(I=K=0;0<=m?K<m:K>m;I=0<=m?++K:--K){if(i[I].y<0){J=[a[L].x+14,a[L].y+16],i[I].x=J[0],i[I].y=J[1];break}}return null};G=function(){var J,K,I;for(K=0,I=i.length;K<I;K++){J=i[K];if(J.y<0){continue}J.y+=4;if(J.y>l.height){J.y=-999}}return null};x=function(){return w.y<v.y-8};H=function(){if((x()===false)&&l.input.a){return w.y-=8}};z=function(){if(x()){w.y-=8;if(w.y<-32){return w.y=v.y-8}}};y=function(){if(l.input.left){v.x=Math.max(v.x-4,0)}if(l.input.right){v.x=Math.min(v.x+4,l.width-v.width)}if(!x()){return w.x=v.x+14}};F=function(){var K,J,N,I,M,L;J=false;for(N=0,I=a.length;N<I;N++){K=a[N];M=[K.x+q,K.y+o],K.x=M[0],K.y=M[1];K.tick++;K.frame=K.tick>>>4;if((K.y>0)&&((K.x<0)||(K.x>330))){J=true}if(K.y>l.height-40){l.end=true;l.endMessage="帝国はエイリアンに征服されました。\nスコアは "+c+" 点でした";return}}if(J){return L=[-q,6],q=L[0],o=L[1],L}else{return o=0}};D=function(){var K,I,L,J;if(!x()){return}for(I=L=0,J=a.length;L<J;I=++L){K=a[I];if(w.intersect(K)){E(K.x,K.y);w.y=v.y-8;c++;K.parentNode.removeChild(K);a.splice(I,1);h.text="SCORE : "+c;if(a.length<1){setTimeout("initEnemies()",2000);m=Math.min(40,m+4);g=Math.max(g-10,m);j++;f.text="STAGE "+j;return}}}};C=function(){var J,L,I,K;K=[v.x+4,v.y+6],s.x=K[0],s.y=K[1];for(L=0,I=i.length;L<I;L++){J=i[L];if(J.intersect(s)){l.end=true;l.endMessage="自機が破壊されました。もう駄目です。\nスコアは "+c+" 点でした";return}}};E=function(K,J){var I;I=[K,J],u.x=I[0],u.y=I[1];return u.frame=0};A=function(){if(u.y>0){u.frame++;if(u.frame===8){return u.y=-999}}};if(l.end){l.rootScene.backgroundColor="red";l.stop();alert(l.endMessage);return}H();z();y();F();B();G();A();D();return C()})};l.start();return window.initEnemies=k}}).call(this);